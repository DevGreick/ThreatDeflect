# rules.yaml
# Arquivo de configuração de regras para o ThreatDeflect Repository Analyzer
# Contém definições para ignorar arquivos, focar em alvos específicos e as regras de detecção.

# Padrões de arquivos e diretórios a serem ignorados durante a análise.
ignore_patterns:
  directories:
    - '/node_modules/'
    - '/dist/'
    - '/build/'
    - '/__tests__/'
    - '/test/'
    - '/tests/'
    - '/docs/'
    - '/.git/'
    - '/.venv/'
    - '/venv/'
    - '/.terraform/'
    - '/.cache/'
    - '/.npm/'
    - '/.yarn/'
    - '/.idea/'
    - '/.vscode/'
    - '/obj/'
    - '/bin/'
  files:
    - '.lock'
    - '.min.js'
    - '.spec.js'
    - '.test.js'
    - '.png'
    - '.jpg'
    - '.jpeg'
    - '.gif'
    - '.svg'
    - '.ico'
    - '.webp'
    - '.mp4'
    - '.mov'
    - '.avi'
    - '.pdf'
    - '.zip'
    - '.tar.gz'
    - '.rar'
    - '.woff'
    - '.woff2'
    - '.eot'
    - '.ttf'
    - '.otf'
    - '.pyc'
    - '.log'
    - '.sqlite'
    - '.db'
    - '.jar'
    - '.whl'
    - '.egg'
    - '.7z'
    - '.gz'
    - '.DS_Store'

# Arquivos que devem ser priorizados para análise de conteúdo.
file_scan_targets:
  interesting_extensions:
    - '.js'
    - '.ts'
    - '.py'
    - '.json'
    - '.yml'
    - '.yaml'
    - '.sh'
    - '.bash'
    - '.config'
    - '.conf'
    - '.properties'
    - '.toml'
    - '.xml'
    - '.pem'
    - '.key'
    - '.tf'
    - '.tfvars'
    - 'Dockerfile'
    - '.ps1'
    - '.bat'
    - '.zsh'
    - '.fish'
    - '.php'
    - '.rb'
    - '.sql'
    - 'Jenkinsfile'
    - 'docker-compose.yml'
    - '.k8s.yml'
  sensitive_filenames:
    - '.env'
    - '.env.local'
    - '.env.development'
    - '.env.production'
    - '.envrc'
    - 'credentials'
    - 'credentials.json'
    - 'credentials.yml'
    - 'config.json'
    - 'config.yml'
    - 'settings.xml'
    - 'database.yml'
    - 'id_rsa'
    - 'private.key'
    - 'server.key'
    - '.pem'
    - '.npmrc'
    - '.pypirc'
    - '.git-credentials'
    - '.boto'
    - 'terraform.tfstate'
    - '.bash_history'
    - '.zsh_history'
    - 'constants.js'
    - 'settings.py'
    - 'config.php'
    - '.netrc'
    - 'kubeconfig'
    - 'gcloud.json'
    - 'secrets.yml'
  dependency_files:
    - 'package.json'
    - 'requirements.txt'
    - 'pom.xml'
    - 'composer.json'

# Mapeamento dos tipos de achado para um nível de severidade.
severity_map:
  "Malicious Dependency": "CRITICAL"
  "Private Key": "CRITICAL"
  "GitHub Token": "CRITICAL"
  "GitLab PAT": "CRITICAL"
  "Slack Token": "CRITICAL"
  "Stripe API Key": "CRITICAL"
  "Heroku API Key": "CRITICAL"
  "Password in URL": "CRITICAL"
  "NPM Dangerous Hook": "CRITICAL"
  "Remote Script Execution": "CRITICAL"
  "Hidden IOC (Base64)": "CRITICAL"
  "Validated Generic API Key": "HIGH"
  "Validated Suspicious Command": "HIGH"
  "AWS Key": "HIGH"
  "Google Cloud API Key": "HIGH"
  "Google OAuth Client ID": "HIGH"
  "Twilio SID": "HIGH"
  "Twilio Auth Token": "HIGH"
  "JSON Web Token (JWT)": "HIGH"
  "Sensitive File": "HIGH"
  "PowerShell Encoded": "HIGH"
  "High Entropy String": "MEDIUM"
  "Generic API Key": "MEDIUM"
  "Suspicious Command": "MEDIUM"
  "Suspicious JS Keyword": "MEDIUM"
  "Invisible Whitespace": "MEDIUM"
  "Trailing Whitespace": "LOW"

# ===================================================================
# Definição das Regras de Detecção por Padrão de Conteúdo
# ===================================================================
rules:
  - id: "Private Key"
    pattern: "-----BEGIN ((EC|RSA|OPENSSH) )?PRIVATE KEY-----"
  - id: "GitHub Token"
    pattern: "(ghp|gho|ghu|ghs|ghr)_[0-9a-zA-Z]{36}"
  - id: "GitLab PAT"
    pattern: "glpat-[0-9a-zA-Z\\-\\_]{20}"
  - id: "Slack Token"
    pattern: "xox[baprs]-[0-9a-zA-Z]{10,48}"
  - id: "Stripe API Key"
    pattern: "sk_live_[0-9a-zA-Z]{24}"
  - id: "Heroku API Key"
    pattern: "[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}"
  - id: "Password in URL"
    pattern: "[a-zA-Z0-9]+://[^:]+:[^@]+@"
  - id: "AWS Key"
    pattern: "AKIA[0-9A-Z]{16}"
  - id: "Google Cloud API Key"
    pattern: "AIza[0-9A-Za-z\\-_]{35}"
  - id: "Google OAuth Client ID"
    pattern: "[0-9]+-[0-9a-zA-Z_]{32}\\.apps\\.googleusercontent\\.com"
  - id: "Twilio SID"
    pattern: "AC[a-f0-9]{32}"
  - id: "Twilio Auth Token"
    pattern: "SK[a-f0-9]{32}"
  - id: "JSON Web Token (JWT)"
    pattern: "ey[a-zA-Z0-9_=-]+\\.[a-zA-Z0-9_=-]+\\.[a-zA-Z0-9_=-]+"
  - id: "PowerShell Encoded"
    pattern: "powershell.*-e(n|nc|nco|ncod|ncode|encoded)?[a-zA-Z0-9\\s+/=]+"
  - id: "Generic API Key"
    pattern: '[aA][pP][iI]_?[kK][eE][yY].*[\''|"][0-9a-zA-Z]{32,}[\''|"]'
  - id: "Remote Script Execution"
    pattern: 'curl\s+[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)\s*\|\s*(bash|sh)'
  - id: "Suspicious Command" 
    pattern: 'wget\s+.*\s+-O\s+/tmp/.*'
  - id: "Trailing Whitespace"
    pattern: "[ \\t]+$"
  - id: "Invisible Whitespace"
    pattern: "[\u00A0\u200B\u202F]"
